<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vera Chat - Enhanced</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/standalone/umd/vis-network.min.js"></script>
    <!-- Syntax Highlighting-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/cypher.css">
    <link rel="stylesheet" href="css/chat-history.css">
    <link rel="stylesheet" href="css/graph-ui.css">
</head>
<body>
    <div class="container">
        <div class="header" id="header">
            <div>
                <h1 style="font-size: 20px; margin-bottom: 4px;">Vera Chat</h1>
                <div style="font-size: 12px; color: #94a3b8;">
                    <span class="status-dot" id="statusDot"></span>
                    <span id="connectionStatus">Connecting...</span> • 
                    <span id="sessionInfo">No session</span>
                </div>
            </div>
            <button class="minimize-btn" id="minimizeHeaderBtn" onclick="toggleHeader()" title="Minimize header">
                <span id="minimizeIcon">▲</span>
            </button>
            <div id="vera-robot"></div>
        </div>

        <div class="main-content" id="mainContent">

        </div>

        <div id="settings-panel">
            <div class="settings-section">
                <h3>Graph Controls</h3>
                <button class="settings-btn" id="reset-focus-btn">Reset View</button>
                <button class="settings-btn" id="cluster-hubs-btn">Cluster Hubs</button>
            </div>

            <div class="settings-section">
                <h3>Edge Filters</h3>
                <div style="margin-bottom: 12px;">
                    <button class="settings-btn" id="select-all-filters-btn">Select All</button>
                    <button class="settings-btn" id="deselect-all-filters-btn">Deselect All</button>
                    <button class="settings-btn" id="refresh-filters-btn">Refresh</button>
                </div>
                <div>
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; font-size: 13px; color: #cbd5e1;">
                        <input type="checkbox" id="cascade-hide">
                        Hide isolated nodes
                    </label>
                </div>
                <div id="edge-filters"></div>
            </div>

            <div class="settings-section">
                <h3>Visual Settings</h3>
                
                <div class="slider-container">
                    <label>
                        <span>Node Style</span>
                    </label>
                    <select id="nodeStyle">
                        <option value="dot">Dot</option>
                        <option value="box">Box</option>
                        <option value="card">Card View</option>
                        <option value="circle">Circle</option>
                        <option value="ellipse">Ellipse</option>
                        <option value="diamond">Diamond</option>
                    </select>
                </div>

                <div class="slider-container">
                    <label>
                        <span>Node Size</span>
                        <span id="nodeSizeVal">25</span>
                    </label>
                    <input type="range" id="nodeSize" min="10" max="50" value="25">
                </div>

                <div class="slider-container">
                    <label>
                        <span>Edge Width</span>
                        <span id="edgeWidthVal">2</span>
                    </label>
                    <input type="range" id="edgeWidth" min="1" max="10" value="2">
                </div>

                <div class="slider-container">
                    <label>
                        <span>Physics Strength</span>
                        <span id="physicsVal">0.010</span>
                    </label>
                    <input type="range" id="physics" min="0.001" max="0.1" step="0.001" value="0.01">
                </div>
            </div>
        </div>

        <div id="property-panel">
            <div class="panel-header-controls">
                <h2>Node Details</h2>
                <button class="panel-btn" id="close-panel-btn" onclick="document.getElementById('property-panel').classList.remove('active');">✕</button>
            </div>
            <div id="panel-content">
                <p style="color: #94a3b8; padding: 20px;">Click a node to see details...</p>
            </div>
        </div>

        <div id="context-menu" style="
            position: fixed;
            display: none;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            z-index: 10000;
            min-width: 220px;
            padding: 6px 0;
        ">
            <!-- Discovery Section -->
            <div class="context-menu-section-title">Discovery</div>
            <div class="context-menu-item" data-action="hidden-relationships">
                Find Hidden Relationships
            </div>
            <div class="context-menu-item" data-action="similar-nodes">
                Find Similar Nodes
            </div>
            <div class="context-menu-item" data-action="find-paths">
                Find Paths To...
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- Expand Section - UPDATED -->
            <div class="context-menu-section-title">Expand</div>
            <div class="context-menu-item" data-action="expand-neighbors">
                Expand Neighbors...
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- View Section -->
            <div class="context-menu-section-title">View</div>
            <div class="context-menu-item" data-action="subgraph">
                Extract Subgraph
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- Analysis Section -->
            <div class="context-menu-section-title">Analysis</div>
            <div class="context-menu-item" data-action="search">
                Search
            </div>
            <div class="context-menu-item" data-action="enrich">
                Enrich (NLP)
            </div>
            <div class="context-menu-item" data-action="extract-entities">
                Extract Entities
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- Generate Section -->
            <div class="context-menu-section-title">Generate</div>
            <div class="context-menu-item" data-action="discover">
                Discover
            </div>
            <div class="context-menu-item" data-action="ideas">
                Generate Idea Stubs
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- Tools Section -->
            <div class="context-menu-section-title">Tools</div>
            <div class="context-menu-item" data-action="execute-tool">
                Execute Tool
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- AI Section -->
            <div class="context-menu-section-title">AI</div>
            <div class="context-menu-item" data-action="ask-vera">
                Ask Vera
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- Manage Section -->
            <div class="context-menu-section-title">Manage</div>
            <div class="context-menu-item" data-action="clear-discovered">
                Clear Discovered
            </div>
        </div>


    </div>
    <div id="floating-widgets"></div>

    <script src="tamagochi/tamagochi_robot.js"></script> 
    <script src="js/polygon/polygon.js"></script>
    <script src="js/session/startup.js"></script>
    <script src="js/graph_/graph-addon.js"></script>
    <script src="js/session/session.js"></script>
    <script src="js/ollama.js"></script>
    <script src="js/graph_/discovery.js"></script>
    <script src="js/graph_/context_menu.js"></script>
    <script src="js/graph_/tool-menu.js"></script>
    <script src="js/graph_/info-card.js"></script>
    <!-- <script src="js/graph/data.js"></script>
    <script src="js/graph/style.js"></script>
    <script src="js/graph/filters.js"></script>
    <script src="js/graph/ui.js"></script>
    <script src="js/graph/core.js"></script>
    <script src="js/graph/init.js"></script> -->
    <script src="js/graph_/graph_init.js"></script>
    <script src="js/graph_/graph.js"></script>
    <script src="js/config-manager.js"></script>
    <script src="js/graph_/cypher.js"></script> 
    <script src="js/toolchain/toolchain.js"></script>
    <script src="js/toolchain/toolchain-workflows.js"></script>
    <script src="js/toolchain/toolchain-query.js"></script>
    <script src="js/proactive-focus-manager.js?v=3"></script>
    <script src="js/memory.js?v=3"></script>
    <script src="js/notebook.js"></script>
    <script src="js/agents.js"></script>
    <script src="js/session/theme.js"></script>
    <script src="js/canvas/canvas.js"></script>

    <script src="js/orchestrator.js"></script>
    <link rel="stylesheet" href="css/enhanced-chat.css">
    <script src="js/chat/enhanced_chat.js"></script>
    <script src="js/chat/history.js"></script>
  
    <script>// Header minimize/expand functionality
        function toggleHeader() {
            const header = document.getElementById('header');
            const icon = document.getElementById('minimizeIcon');
            const btn = document.getElementById('minimizeHeaderBtn');
            
            header.classList.toggle('minimized');
            
            if (header.classList.contains('minimized')) {
                icon.textContent = '▼';
                btn.title = 'Expand header';
                localStorage.setItem('headerMinimized', 'true');
            } else {
                icon.textContent = '▲';
                btn.title = 'Minimize header';
                localStorage.setItem('headerMinimized', 'false');
            }
        }

        // Restore state on page load
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('headerMinimized') === 'true') {
                document.getElementById('header').classList.add('minimized');
                document.getElementById('minimizeIcon').textContent = '▼';
            }
        });

        // Update status dot based on connection (call this from your connection logic)
        function updateStatusDot(status) {
            const dot = document.getElementById('statusDot');
            if (dot) {
                dot.className = 'status-dot';
                if (status === 'connected') dot.classList.add('connected');
                else if (status === 'disconnected') dot.classList.add('disconnected');
                else dot.classList.add('connecting');
            }
        }
    </script>
</body>
</html>