<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vera Chat - Enhanced</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/standalone/umd/vis-network.min.js"></script>
    <!-- Syntax Highlighting-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- Agent YAML Parsing-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/cypher.css">
    <link rel="stylesheet" href="css/chat-history.css">
    <link rel="stylesheet" href="css/graph-ui.css">
</head>
<body>
    <div class="container">
        <div class="header" id="header">
            <div>
                <h1 style="font-size: 20px; margin-bottom: 4px;">Vera Chat</h1>
                <div style="font-size: 12px; color: #94a3b8;">
                    <span class="status-dot" id="statusDot"></span>
                    <span id="connectionStatus">Connecting...</span> ‚Ä¢ 
                    <span id="sessionInfo">No session</span>
                </div>
            </div>
            <button class="minimize-btn" id="minimizeHeaderBtn" onclick="toggleHeader()" title="Minimize header">
                <span id="minimizeIcon">‚ñ≤</span>
            </button>
            <div id="vera-robot"></div>
        </div>

        <div class="main-content" id="mainContent">

        </div>

        <div id="settings-panel">
            <div class="settings-section">
                <h3>Graph Controls</h3>
                <button class="settings-btn" id="reset-focus-btn">Reset View</button>
                <button class="settings-btn" id="cluster-hubs-btn">Cluster Hubs</button>
            </div>

            <div class="settings-section">
                <h3>Edge Filters</h3>
                <div style="margin-bottom: 12px;">
                    <button class="settings-btn" id="select-all-filters-btn">Select All</button>
                    <button class="settings-btn" id="deselect-all-filters-btn">Deselect All</button>
                    <button class="settings-btn" id="refresh-filters-btn">Refresh</button>
                </div>
                <div>
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; font-size: 13px; color: #cbd5e1;">
                        <input type="checkbox" id="cascade-hide">
                        Hide isolated nodes
                    </label>
                </div>
                <div id="edge-filters"></div>
            </div>

            <div class="settings-section">
                <h3>Visual Settings</h3>
                
                <div class="slider-container">
                    <label>
                        <span>Node Style</span>
                    </label>
                    <select id="nodeStyle">
                        <option value="dot">Dot</option>
                        <option value="box">Box</option>
                        <option value="card">Card View</option>
                        <option value="circle">Circle</option>
                        <option value="ellipse">Ellipse</option>
                        <option value="diamond">Diamond</option>
                    </select>
                </div>

                <div class="slider-container">
                    <label>
                        <span>Node Size</span>
                        <span id="nodeSizeVal">25</span>
                    </label>
                    <input type="range" id="nodeSize" min="10" max="50" value="25">
                </div>

                <div class="slider-container">
                    <label>
                        <span>Edge Width</span>
                        <span id="edgeWidthVal">2</span>
                    </label>
                    <input type="range" id="edgeWidth" min="1" max="10" value="2">
                </div>

                <div class="slider-container">
                    <label>
                        <span>Physics Strength</span>
                        <span id="physicsVal">0.010</span>
                    </label>
                    <input type="range" id="physics" min="0.001" max="0.1" step="0.001" value="0.01">
                </div>
            </div>
        </div>

        <div id="property-panel">
            <div class="panel-header-controls">
                <h2>Node Details</h2>
                <button class="panel-btn" id="close-panel-btn" onclick="document.getElementById('property-panel').classList.remove('active');">‚úï</button>
            </div>
            <div id="panel-content">
                <p style="color: #94a3b8; padding: 20px;">Click a node to see details...</p>
            </div>
        </div>

        <div id="context-menu" style="
            position: fixed;
            display: none;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            z-index: 10000;
            max-height: 40vh;
            min-width: 220px;
            padding: 6px 0;
            overflow-y: auto;
        ">
            <!-- Discovery Section -->
            <div class="context-menu-section-title">Discovery</div>
            <div class="context-menu-item" data-action="hidden-relationships">
                Find Hidden Relationships
            </div>
            <div class="context-menu-item" data-action="similar-nodes">
                Find Similar Nodes
            </div>
            <div class="context-menu-item" data-action="find-paths">
                Find Paths To...
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- Expand Section - UPDATED -->
            <div class="context-menu-section-title">Expand</div>
            <div class="context-menu-item" data-action="expand-neighbors">
                Expand Neighbors...
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- View Section -->
            <div class="context-menu-section-title">View</div>
            <div class="context-menu-item" data-action="subgraph">
                Extract Subgraph
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- Analysis Section -->
            <div class="context-menu-section-title">Analysis</div>
            <div class="context-menu-item" data-action="search">
                Search
            </div>
            <div class="context-menu-item" data-action="enrich">
                Enrich (NLP)
            </div>
            <div class="context-menu-item" data-action="extract-entities">
                Extract Entities
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- Generate Section -->
            <div class="context-menu-section-title">Generate</div>
            <div class="context-menu-item" data-action="discover">
                Discover
            </div>
            <div class="context-menu-item" data-action="ideas">
                Generate Idea Stubs
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- Tools Section -->
            <div class="context-menu-section-title">Tools</div>
            <div class="context-menu-item" data-action="execute-tool">
                Execute Tool
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- AI Section -->
            <div class="context-menu-section-title">AI</div>
            <div class="context-menu-item" data-action="ask-vera">
                Ask Vera
            </div>
            
            <div class="context-menu-divider"></div>
            
            <!-- Manage Section -->
            <div class="context-menu-section-title">Manage</div>
            <div class="context-menu-item" data-action="clear-discovered">
                Clear Discovered
            </div>
        </div>

       <div id="canvas-context-menu" class="context-menu" style="display: none;">
        <!-- View Section -->
        <div class="context-menu-section">
            <div class="context-menu-section-title">View</div>
            <div class="context-menu-item" data-action="reset-view">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Reset View</span>
            </div>
            <div class="context-menu-item" data-action="fit-view">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Fit to Screen</span>
            </div>
            <div class="context-menu-item" data-action="zoom-in">
                <!-- <span class="context-menu-icon">üîç+</span> -->
                <span>Zoom In</span>
            </div>
            <div class="context-menu-item" data-action="zoom-out">
                <!-- <span class="context-menu-icon">üîç-</span> -->
                <span>Zoom Out</span>
            </div>
        </div>

        <!-- Add Section -->
        <div class="context-menu-section">
            <div class="context-menu-section-title">Add</div>
            <div class="context-menu-item" data-action="add-node">
                <!-- <span class="context-menu-icon">‚ûï</span> -->
                <span>Add Node</span>
            </div>
            <div class="context-menu-item" data-action="add-edge">
                <!-- <span class="context-menu-icon">üîó</span> -->
                <span>Add Edge</span>
            </div>
        </div>

        <!-- Selection Section -->
        <div class="context-menu-section">
            <div class="context-menu-section-title">Selection</div>
            <div class="context-menu-item" data-action="select-all">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Select All</span>
            </div>
            <div class="context-menu-item" data-action="clear-selection">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Clear Selection</span>
            </div>
            <div class="context-menu-item" data-action="invert-selection">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Invert Selection</span>
            </div>
        </div>

        <!-- Layout Section -->
        <div class="context-menu-section">
            <div class="context-menu-section-title">Layout</div>
            <div class="context-menu-item" data-action="layout-hierarchical">
                <!-- <span class="context-menu-icon">üå≥</span> -->
                <span>Hierarchical</span>
            </div>
            <div class="context-menu-item" data-action="layout-force">
                <!-- <span class="context-menu-icon">‚ö°</span> -->
                <span>Force-Directed</span>
            </div>
            <div class="context-menu-item" data-action="layout-circular">
                <!-- <span class="context-menu-icon">‚≠ï</span> -->
                <span>Circular</span>
            </div>
            <div class="context-menu-item" data-action="layout-random">
                <!-- <span class="context-menu-icon">üé≤</span> -->
                <span>Random</span>
            </div>
        </div>

        <!-- Style Section -->
        <!-- <div class="context-menu-section">
            <div class="context-menu-section-title">Style</div>
            <div class="context-menu-item" data-action="style-default">
                <span class="context-menu-icon"></span>
                <span>Default Style</span>
            </div>
            <div class="context-menu-item" data-action="style-minimal">
                <span class="context-menu-icon"></span>
                <span>Minimal Style</span>
            </div>
            <div class="context-menu-item" data-action="style-vibrant">
                <span class="context-menu-icon"></span>
                <span>Vibrant Style</span>
            </div>
        </div> -->

        <!-- Tools Section -->
        <div class="context-menu-section">
            <div class="context-menu-section-title">Tools</div>
            <div class="context-menu-item" data-action="execute-tool-direct">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Run Tool</span>
            </div>
            <div class="context-menu-item" data-action="run-tool">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Execute Tool</span>
            </div>
            <div class="context-menu-item" data-action="generate-nodes">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Generate Nodes</span>
            </div>
            <div class="context-menu-item" data-action="generate-edges">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Generate Edges</span>
            </div>
        </div>

        <!-- Search & Insights Section -->
        <div class="context-menu-section">
            <div class="context-menu-section-title">AI Insights</div>
            <div class="context-menu-item" data-action="ai-assistant">
                <!-- <span class="context-menu-icon"></span> -->
                <span>ai-assistant</span>
            </div>
            <div class="context-menu-item" data-action="execute-tool-ai">
                <!-- <span class="context-menu-icon"></span> -->
                <span>execute-tool-ai</span>
            </div>
            <div class="context-menu-item" data-action="ai-summarize">
                <!-- <span class="context-menu-icon"></span> -->
                <span>ai-summarize</span>
            </div>
            <div class="context-menu-item" data-action="ai-find-key">
                <!-- <span class="context-menu-icon"></span> -->
                <span>ai-find-key</span>
            </div>
                        <div class="context-menu-item" data-action="ai-patterns">
                <!-- <span class="context-menu-icon"></span> -->
                <span>ai-patterns</span>
            </div>
                        <div class="context-menu-item" data-action="ai-suggest">
                <!-- <span class="context-menu-icon"></span> -->
                <span>ai-suggest</span>
            </div>
        </div>

        <!-- Search & Insights Section -->
        <div class="context-menu-section">
            <div class="context-menu-section-title">Search & Insights</div>
            <div class="context-menu-item" data-action="search-graph">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Search Graph</span>
            </div>
            <div class="context-menu-item" data-action="find-patterns">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Find Patterns</span>
            </div>
            <div class="context-menu-item" data-action="analyze-structure">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Analyze Structure</span>
            </div>
            <div class="context-menu-item" data-action="find-communities">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Find Communities</span>
            </div>
        </div>

        <!-- Export Section -->
        <div class="context-menu-section">
            <div class="context-menu-section-title">Export</div>
            <div class="context-menu-item" data-action="export-image">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Export as Image</span>
            </div>
            <div class="context-menu-item" data-action="export-json">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Export as JSON</span>
            </div>
        </div>

        <!-- Settings Section -->
        <div class="context-menu-section">
            <div class="context-menu-section-title">Settings</div>
            <div class="context-menu-item" data-action="physics-toggle">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Toggle Physics</span>
            </div>
            <div class="context-menu-item" data-action="canvas-settings">
                <!-- <span class="context-menu-icon"></span> -->
                <span>Canvas Settings</span>
            </div>
        </div>
    </div>

    <style>
        /* Context Menu Styling (shared between node and canvas menus) */
        .context-menu {
            position: fixed;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 10000;
            min-width: 220px;
            max-height: 40vh;
            overflow-y: auto;
            padding: 4px;
        }

        .context-menu-section {
            margin: 4px 0;
        }

        .context-menu-section:not(:last-child) {
            border-bottom: 1px solid #334155;
            padding-bottom: 4px;
        }

        .context-menu-section-title {
            color: #64748b;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 6px 12px 4px;
            margin-top: 4px;
        }

        .context-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            cursor: pointer;
            color: #e2e8f0;
            font-size: 13px;
            border-radius: 4px;
            transition: all 0.15s ease;
        }

        .context-menu-item:hover {
            background: #334155;
            color: #ffffff;
        }

        .context-menu-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        /* Scrollbar styling for context menu */
        .context-menu::-webkit-scrollbar {
            width: 8px;
        }

        .context-menu::-webkit-scrollbar-track {
            background: #0f172a;
            border-radius: 4px;
        }

        .context-menu::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        .context-menu::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>



    </div>
    <div id="floating-widgets"></div>

    <script src="tamagochi/tamagochi_robot.js"></script> 
    <script src="js/polygon/polygon.js"></script>
    <script src="js/session/startup.js"></script>
    <script src="js/graph_/graph-addon.js"></script>
    <script src="js/session/session.js"></script>
    <script src="js/ollama.js"></script>
    <script src="js/graph_/discovery.js"></script>
    <script src="js/graph_/assistant.js"></script>
    <script src="js/graph_/tools.js"></script>
    <script src="js/graph_/context_menu.js"></script>
    <script src="js/graph_/canvas_context_menu.js"></script>
    <script src="js/graph_/tool-menu.js"></script>
    <script src="js/graph_/info-card.js"></script>
    <script src="js/graph_/style.js"></script>
    <script src="js/graph_/loader.js"></script>
    <script src="js/graph_/graph_storage.js"></script>
    
    <!-- <script src="js/graph/data.js"></script>
    <script src="js/graph/style.js"></script>
    <script src="js/graph/filters.js"></script>
    <script src="js/graph/ui.js"></script>
    <script src="js/graph/core.js"></script>
    <script src="js/graph/init.js"></script> -->
    <script src="js/graph_/graph_init.js"></script>
    <script src="js/graph_/graph.js"></script>
    <script src="js/config-manager.js"></script>
    <script src="js/graph_/cypher.js"></script> 
    <script src="js/toolchain/toolchain.js"></script>
    <script src="js/toolchain/toolchain-workflows.js"></script>
    <script src="js/toolchain/toolchain-query.js"></script>
    <script src="js/proactive-focus-manager.js?v=3"></script>
    <script src="js/memory.js?v=3"></script>
    <script src="js/notebook.js"></script>
    <script src="js/agents.js"></script>
    <script src="js/session/theme.js"></script>
    <script src="js/canvas/canvas.js"></script>

    <script src="js/orchestrator.js"></script>
    <link rel="stylesheet" href="css/enhanced-chat.css">
    <script src="js/chat/enhanced_chat.js"></script>
    <script src="js/chat/history.js"></script>
    <script src="js/chat/chat-box-enhancements.js"></script>
    <script src="js/chat/graph.js"></script>
    <script src="js/chat/graph-init.js"></script>
    <script src="js/chat/toolchain-render.js"></script>
    <script src="js/calendar/scheduling,js"></script>

    <script>// Header minimize/expand functionality
        function toggleHeader() {
            const header = document.getElementById('header');
            const icon = document.getElementById('minimizeIcon');
            const btn = document.getElementById('minimizeHeaderBtn');
            
            header.classList.toggle('minimized');
            
            if (header.classList.contains('minimized')) {
                icon.textContent = '‚ñº';
                btn.title = 'Expand header';
                localStorage.setItem('headerMinimized', 'true');
            } else {
                icon.textContent = '‚ñ≤';
                btn.title = 'Minimize header';
                localStorage.setItem('headerMinimized', 'false');
            }
        }

        // Restore state on page load
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('headerMinimized') === 'true') {
                document.getElementById('header').classList.add('minimized');
                document.getElementById('minimizeIcon').textContent = '‚ñº';
            }
        });

        // Update status dot based on connection (call this from your connection logic)
        function updateStatusDot(status) {
            const dot = document.getElementById('statusDot');
            if (dot) {
                dot.className = 'status-dot';
                if (status === 'connected') dot.classList.add('connected');
                else if (status === 'disconnected') dot.classList.add('disconnected');
                else dot.classList.add('connecting');
            }
        }
    </script>
</body>
</html>